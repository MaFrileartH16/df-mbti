import{r as j,j as a,B as se,F as ne}from"./app-ujya-KCz.js";import{A as oe,S as b,a as le,f as d,i as he,B as ce}from"./AppLayout-uetAMH0A.js";import{M as pe,E as de,a as me}from"./jspdf.plugin.autotable-DYWG1lk8.js";import{G as p}from"./Grid-Bur5Fcdp.js";import{I as W}from"./use-dates-input-Dgk_-w9H.js";import{S as z}from"./Select-Cxm2Nn1D.js";import{T as ge}from"./TextInput-RZZTAhZD.js";import{I as xe}from"./IconSearch-BPXhK1Gi.js";import{C as H}from"./Center-AKgzOOpp.js";import{L as u}from"./List-9dn9vg5L.js";import{T as s}from"./Table-D29K3aYW.js";import"./get-base-value-OFsWh4f6.js";import"./InputBase-o0xNPV29.js";import"./Input-D_xKmpb8.js";import"./clamp-DTmYCdls.js";import"./CheckIcon-DPnDoRdz.js";import"./ScrollArea-BByIigrI.js";const _e=o=>{var N;const[S,J]=j.useState(""),[m,M]=j.useState(""),[D,Y]=j.useState(""),[h,G]=j.useState(o.auth.user.role==="Dosen PA"?o.auth.user.id:""),g=o.students.filter(e=>(!S||e.user.full_name.toLowerCase().includes(S.toLowerCase()))&&(!D||e.academic_year===D)&&(!h||e.supervisor_id===h)&&(!m||m===""||e.tests.length&&new Date(e.tests[0].created_at).toLocaleDateString("id-ID").includes(m))),L=g.reduce((e,i)=>{const l=i!=null&&i.tests.length?i==null?void 0:i.tests[0].work.name:"-";return l!=="-"&&(e[l]=(e[l]||0)+1),e},{}),v=g.reduce((e,i)=>{const l=i!=null&&i.tests.length?i==null?void 0:i.tests[0].personality:"-";return l!=="-"&&(e[l]=(e[l]||0)+1),e},{}),U=(e,i,l)=>{var $,B;const r=new de;console.log(l),r.addImage("/unsada.png","PNG",10,10,30,30),r.setFontSize(12),r.text("UNIVERSITAS DARMA PERSADA",50,15),r.text("Jl. Taman Malaka Selatan, Pondok Kelapa, Jakarta Timur, Indonesia 13450",50,20),r.text("Telp. (021) 8649051, 8649053, 8649057 Fax. (021) 8649052",50,25),r.text("E-mail : humas@unsada.ac.id Home page : http//www.unsada.ac.id",50,30),r.setLineWidth(.5),r.line(10,40,200,40);const x=new Date,Q=["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"];if(l){const[t,n]=l.split("/");x.setMonth(t-1),x.setFullYear(n)}const _=`Periode: ${Q[x.getMonth()]} ${x.getFullYear()}`;r.setFontSize(18);const R="LAPORAN HASIL TES KEPRIBADIAN MAHASISWA",X=r.getTextWidth(R);r.text(R,(r.internal.pageSize.width-X)/2,50),r.setFontSize(12);const Z=r.getTextWidth(_);r.text(_,(r.internal.pageSize.width-Z)/2,60);const T=e.filter(t=>t["Tipe Kepribadian"]&&t["Saran Pekerjaan"]&&t["Tipe Kepribadian"]!=="-"&&t["Saran Pekerjaan"]!=="-"),f=T.reduce((t,n)=>(t[n["Saran Pekerjaan"]]=(t[n["Saran Pekerjaan"]]||0)+1,t),{}),w=T.reduce((t,n)=>(t[n["Tipe Kepribadian"]]=(t[n["Tipe Kepribadian"]]||0)+1,t),{});let c=70;h&&(r.text("Nama Dosen PA:",10,c),r.text((($=o.lecturers.find(t=>t.user.id===h))==null?void 0:$.user.full_name)||"Nama tidak ditemukan",50,c)),r.text("Saran Pekerjaan:",10,c+10),Object.entries(f).forEach(([t,n],C)=>{r.text(`${t}: ${n} Mahasiswa`,10,c+15+C*5)});const ee=Object.values(f).reduce((t,n)=>t+n,0);r.text(`Total Mahasiswa: ${ee}`,10,c+15+Object.entries(f).length*5),r.text("Tipe Kepribadian:",110,c+10),Object.entries(w).forEach(([t,n],C)=>{r.text(`${t}: ${n} Mahasiswa`,110,c+15+C*5)});const ae=Object.values(w).reduce((t,n)=>t+n,0);r.text(`Total Mahasiswa: ${ae}`,110,c+15+Object.entries(w).length*5);const re=T.map(t=>Object.values(t)),ie=i.map(t=>t.header);me(r,{startY:c+50,head:[ie],body:re});const y=h?(B=o.lecturers.find(t=>t.user.id===h))==null?void 0:B.user:o.auth.user,te=y.role,F=y.full_name,O=y.id_number,E=te==="Admin"?"Kepala Prodi":"Dosen Pembimbing Akademik";r.setFontSize(12);const k=r.internal.pageSize.width,A=r.internal.pageSize.height,P=10,I=20,K=5;r.text(E,k-P-r.getTextWidth(E),A-I),r.text(F,k-P-r.getTextWidth(F),A-I+K),r.text(`NIDN: ${O}`,k-P-r.getTextWidth(`NIDN: ${O}`),A-I+2*K),r.save("mrt-pdf-example.pdf")},V=o.auth.user.role==="Admin"&&["#","Foto","NIM","Nama Lengkap","Tahun Angkatan","Dosen PA","Tipe Kepribadian","Saran Pekerjaan","Opsi"],q=[{header:"NIM"},{header:"Nama Lengkap"},{header:"Tahun Angkatan"},{header:"Dosen PA"},{header:"Tipe Kepribadian"},{header:"Saran Pekerjaan"}];return a.jsx(oe,{title:"Mahasiswa",activeNav:"Mahasiswa",authed:o.auth.user,meta:o.meta,children:a.jsxs(b,{gap:32,children:[a.jsxs(p,{grow:!0,children:[a.jsx(p.Col,{span:{base:6,sm:3},children:a.jsx(pe,{styles:{label:{marginBottom:8},input:{height:48,borderRadius:32,paddingLeft:50,paddingRight:16},section:{marginLeft:0,width:48,height:48},error:{marginTop:8}},leftSection:a.jsx(W,{}),clearable:!0,searchable:!0,placeholder:"Periode",checkIconPosition:"right",onChange:e=>{M(e?`${e.getMonth()+1}/${e.getFullYear()}`:"")}})}),a.jsx(p.Col,{span:{base:6,sm:3},children:a.jsx(z,{styles:{label:{marginBottom:8},input:{height:48,borderRadius:32,paddingLeft:50,paddingRight:16},section:{marginLeft:0,width:48,height:48},error:{marginTop:8}},leftSection:a.jsx(W,{}),clearable:!0,searchable:!0,placeholder:"Tahun Angkatan",checkIconPosition:"right",nothingFoundMessage:"Tidak ada tahun ajaran",data:[...new Set(o.students.map(e=>e.academic_year))].sort((e,i)=>i-e),onChange:e=>Y(e)})}),a.jsx(p.Col,{span:{base:6,sm:3},children:a.jsx(z,{styles:{label:{marginBottom:8},input:{height:48,borderRadius:32,paddingLeft:50,paddingRight:16},section:{marginLeft:0,width:48,height:48},error:{marginTop:8}},leftSection:a.jsx(le,{}),clearable:!0,searchable:!0,value:h,disabled:o.auth.user.role==="Dosen PA",nothingFoundMessage:"Tidak ada dosen pembimbing",checkIconPosition:"right",placeholder:"Dosen Pembimbing",data:o.lecturers.map(e=>({label:e.user.full_name,value:e.user.id})).sort((e,i)=>e.label.localeCompare(i.label)),onChange:e=>G(e)})}),a.jsx(p.Col,{span:{base:6,sm:3},children:a.jsx(ge,{styles:{label:{marginBottom:8},input:{height:48,borderRadius:32,paddingLeft:50,paddingRight:16},section:{marginLeft:0,width:48,height:48},error:{marginTop:8}},leftSection:a.jsx(xe,{}),placeholder:"Cari mahasiswa...",value:S,onChange:e=>J(e.currentTarget.value)})})]}),a.jsx(d,{c:"blue",onClick:()=>U(g.map(e=>({NIM:e.user.id_number,"Nama Lengkap":e.user.full_name,"Tahun Angkatan":e.academic_year,DPA:e.supervisor.user.full_name,"Tipe Kepribadian":e!=null&&e.tests.length?e==null?void 0:e.tests[0].personality:"-","Saran Pekerjaan":e!=null&&e.tests.length?e==null?void 0:e.tests[0].work.name:"-"})),q,m),children:"Cetak Laporan"}),a.jsxs(p,{children:[h&&a.jsx(p.Col,{span:4,children:a.jsxs(b,{children:[a.jsx(d,{fw:600,children:"Nama Dosen PA :"}),a.jsx(d,{children:((N=o.lecturers.find(e=>e.user.id===h))==null?void 0:N.user.full_name)||"Nama tidak ditemukan"})]})}),a.jsx(p.Col,{span:h?4:6,children:a.jsx(H,{children:a.jsxs(b,{children:[a.jsx(d,{fw:600,children:"Saran Pekerjaan :"}),a.jsx(u,{children:Object.entries(L).map(([e,i])=>a.jsxs(u.Item,{children:[e," : ",i," Mahasiswa"]},e))}),a.jsxs(d,{fw:600,children:["Total Mahasiswa: ",Object.values(L).reduce((e,i)=>e+i,0)]})]})})}),a.jsx(p.Col,{span:h?4:6,children:a.jsx(H,{children:a.jsxs(b,{children:[a.jsx(d,{fw:600,children:"Tipe Kepribadian :"}),a.jsx(u,{children:Object.entries(v).map(([e,i])=>a.jsxs(u.Item,{children:[e," : ",i," Mahasiswa"]},e))}),a.jsxs(d,{fw:600,children:["Total Mahasiswa: ",Object.values(v).reduce((e,i)=>e+i,0)]})]})})})]}),a.jsx(se,{style:{borderRadius:32,border:"1px solid #E9ECEF"},children:a.jsx(s.ScrollContainer,{children:a.jsxs(s,{highlightOnHover:!0,withColumnBorders:!0,children:[a.jsx(s.Thead,{h:64,children:a.jsx(s.Tr,{children:V.map((e,i)=>a.jsx(s.Th,{px:16,py:0,style:{whiteSpace:"nowrap"},children:e},i))})}),a.jsx(s.Tbody,{children:g.map((e,i)=>{var l;return a.jsxs(s.Tr,{h:64,children:[a.jsx(s.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:i+1}),a.jsx(s.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:a.jsx(he,{src:e.user.avatar,alt:e.user.full_name})}),a.jsx(s.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:e.user.id_number}),a.jsx(s.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:e.user.full_name}),o.auth.user.role==="Admin"&&a.jsx(s.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:e.user.id_number.substring(0,4)}),a.jsx(s.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:(l=e==null?void 0:e.supervisor)==null?void 0:l.user.full_name}),a.jsx(s.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:e!=null&&e.tests.length?e==null?void 0:e.tests[0].personality:"-"}),a.jsx(s.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:e!=null&&e.tests.length?e==null?void 0:e.tests[0].work.name:"-"}),a.jsx(s.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:a.jsx(ce,{disabled:!(e!=null&&e.tests.length),px:16,h:48,radius:32,styles:{section:{marginRight:16}},variant:"outline",color:"yellow",onClick:()=>ne.get(route("students.tests.index",e.user_id)),children:"Detail"})})]},i)})})]})})})]})})};export{_e as default};
