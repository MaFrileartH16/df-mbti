import{r as g,j as a,F as p,B as le}from"./app-CwtDxK3m.js";import{A as oe,S as j,a as he,T as H,B as b,f as d,i as ce,F as de}from"./AppLayout-_Gsx7xWj.js";import{M as me,E as pe,a as ue}from"./jspdf.plugin.autotable-D54UHuzZ.js";import{G as h}from"./Grid-DYV7842v.js";import{I as z}from"./use-dates-input-km0Naq4j.js";import{S as J}from"./Select-BELenZga.js";import{T as xe}from"./TextInput-BmhchCCg.js";import{I as ge}from"./IconSearch-CUd54ma6.js";import{I as je}from"./IconPlus-DZEf2Uxl.js";import{C as Y}from"./Center-B3B93ujG.js";import{L as T}from"./List-CUsRw-Xd.js";import{T as n}from"./Table-6xhCLuY6.js";import{C as be}from"./Checkbox-DdbCseWG.js";import"./get-base-value-DyJkT8RS.js";import"./InputBase-BKhPEznL.js";import"./Input-CtDrG7en.js";import"./clamp-DTmYCdls.js";import"./CheckIcon-BS0j4sSw.js";import"./ScrollArea-DAHgCBhp.js";import"./get-auto-contrast-value-Da6zqqWm.js";import"./InputsGroupFieldset-ByQ9gBnF.js";const Be=s=>{var D;const[m,_]=g.useState(""),[f,G]=g.useState(""),[v,U]=g.useState(""),[o,V]=g.useState(s.auth.user.role==="Dosen PA"?s.auth.user.id:""),u=s.students.filter(e=>(!f||e.user.full_name.toLowerCase().includes(f.toLowerCase()))&&(!v||e.academic_year===v)&&(!o||e.supervisor_id===o)&&(!m||m===""||e.tests.length&&new Date(e.tests[0].created_at).toLocaleDateString("id-ID").includes(m))),q=s.auth.user.role==="Admin"?["#","Foto","NIM","Nama Lengkap","Tahun Angkatan","Email","Nomor Telepon","DPA","Aktif","Opsi"]:["#","Foto","NIM","Nama Lengkap","Tahun Angkatan","Tipe Kepribadian","Aktif","Opsi"],Q=[{header:"NIM"},{header:"Nama Lengkap"},{header:"Tahun Angkatan"},{header:"Dosen PA"},{header:"Tipe Kepribadian"},{header:"Saran Pekerjaan"}],N=u.reduce((e,r)=>{const i=r!=null&&r.tests.length?r==null?void 0:r.tests[0].work.name:"-";return i!=="-"&&(e[i]=(e[i]||0)+1),e},{}),L=u.reduce((e,r)=>{const i=r!=null&&r.tests.length?r==null?void 0:r.tests[0].personality:"-";return i!=="-"&&(e[i]=(e[i]||0)+1),e},{}),X=(e,r)=>{var B,W;const i=new pe;i.addImage("/unsada.png","PNG",10,10,30,30),i.setFontSize(12),i.text("UNIVERSITAS DARMA PERSADA",50,15),i.text("Jl. Taman Malaka Selatan, Pondok Kelapa, Jakarta Timur, Indonesia 13450",50,20),i.text("Telp. (021) 8649051, 8649053, 8649057 Fax. (021) 8649052",50,25),i.text("E-mail : humas@unsada.ac.id Home page : http//www.unsada.ac.id",50,30),i.setLineWidth(.5),i.line(10,40,200,40);const x=new Date,Z=["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"];if(m){const[t,l]=m.split("/");x.setMonth(t-1),x.setFullYear(l)}const R=`Periode: ${Z[x.getMonth()]} ${x.getFullYear()}`;i.setFontSize(18);const F="LAPORAN HASIL TES KEPRIBADIAN MAHASISWA",ee=i.getTextWidth(F);i.text(F,(i.internal.pageSize.width-ee)/2,50),i.setFontSize(12);const ae=i.getTextWidth(R);i.text(R,(i.internal.pageSize.width-ae)/2,60);const w=e.filter(t=>t["Tipe Kepribadian"]&&t["Saran Pekerjaan"]&&t["Tipe Kepribadian"]!=="-"&&t["Saran Pekerjaan"]!=="-"),S=w.reduce((t,l)=>(t[l["Saran Pekerjaan"]]=(t[l["Saran Pekerjaan"]]||0)+1,t),{}),y=w.reduce((t,l)=>(t[l["Tipe Kepribadian"]]=(t[l["Tipe Kepribadian"]]||0)+1,t),{});let c=70;o&&(i.text("Nama Dosen PA:",10,c),i.text(((B=s.lecturers.find(t=>t.user.id===o))==null?void 0:B.user.full_name)||"Nama tidak ditemukan",50,c)),i.text("Saran Pekerjaan:",10,c+10),Object.entries(S).forEach(([t,l],M)=>{i.text(`${t}: ${l} Mahasiswa`,10,c+15+M*5)});const ie=Object.values(S).reduce((t,l)=>t+l,0);i.text(`Total Mahasiswa: ${ie}`,10,c+15+Object.entries(S).length*5),i.text("Tipe Kepribadian:",110,c+10),Object.entries(y).forEach(([t,l],M)=>{i.text(`${t}: ${l} Mahasiswa`,110,c+15+M*5)});const re=Object.values(y).reduce((t,l)=>t+l,0);i.text(`Total Mahasiswa: ${re}`,110,c+15+Object.entries(y).length*5);const te=w.map(t=>Object.values(t)),se=r.map(t=>t.header);ue(i,{startY:c+50,head:[se],body:te});const k=o?(W=s.lecturers.find(t=>t.user.id===o))==null?void 0:W.user:s.auth.user,ne=k.role,O=k.full_name,E=k.id_number,K=ne==="Admin"?"Kepala Prodi":"Dosen Pembimbing Akademik";i.setFontSize(12);const A=i.internal.pageSize.width,C=i.internal.pageSize.height,P=10,I=20,$=5;i.text(K,A-P-i.getTextWidth(K),C-I),i.text(O,A-P-i.getTextWidth(O),C-I+$),i.text(`NIDN: ${E}`,A-P-i.getTextWidth(`NIDN: ${E}`),C-I+2*$),i.save("mrt-pdf-example.pdf")};return a.jsx(oe,{title:"Mahasiswa",activeNav:"Mahasiswa",authed:s.auth.user,meta:s.meta,children:a.jsxs(j,{gap:32,children:[a.jsxs(h,{grow:!0,children:[s.auth.user.role!=="Admin"&&a.jsx(h.Col,{span:{base:6,sm:3},children:a.jsx(me,{styles:{label:{marginBottom:8},input:{height:48,borderRadius:32,paddingLeft:50,paddingRight:16},section:{marginLeft:0,width:48,height:48},error:{marginTop:8}},leftSection:a.jsx(z,{}),clearable:!0,searchable:!0,placeholder:"Periode",checkIconPosition:"right",onChange:e=>{_(e?`${e.getMonth()+1}/${e.getFullYear()}`:"")}})}),a.jsx(h.Col,{span:{base:6,sm:3},children:a.jsx(J,{styles:{label:{marginBottom:8},input:{height:48,borderRadius:32,paddingLeft:50,paddingRight:16},section:{marginLeft:0,width:48,height:48},error:{marginTop:8}},leftSection:a.jsx(he,{}),clearable:!0,searchable:!0,value:o,disabled:s.auth.user.role==="Dosen PA",nothingFoundMessage:"Tidak ada dosen pembimbing",checkIconPosition:"right",placeholder:"Dosen Pembimbing",data:s.lecturers.map(e=>({label:e.user.full_name,value:e.user.id})).sort((e,r)=>e.label.localeCompare(r.label)),onChange:e=>V(e)})}),a.jsx(h.Col,{span:{base:6,sm:3},children:a.jsx(J,{styles:{label:{marginBottom:8},input:{height:48,borderRadius:32,paddingLeft:50,paddingRight:16},section:{marginLeft:0,width:48,height:48},error:{marginTop:8}},leftSection:a.jsx(z,{}),clearable:!0,searchable:!0,placeholder:"Tahun Angkatan",checkIconPosition:"right",nothingFoundMessage:"Tidak ada tahun ajaran",data:s.auth.user.role==="Admin"?[...new Set(s.students.map(e=>e.academic_year))].sort((e,r)=>r-e):[...new Set(s.students.filter(e=>e.supervisor_id===s.auth.user.id).map(e=>e.academic_year))].sort((e,r)=>r-e),onChange:e=>U(e)})}),a.jsx(h.Col,{span:{base:6,sm:3},children:a.jsx(xe,{styles:{label:{marginBottom:8},input:{height:48,borderRadius:32,paddingLeft:50,paddingRight:16},section:{marginLeft:0,width:48,height:48},error:{marginTop:8}},leftSection:a.jsx(ge,{}),placeholder:"Cari mahasiswa...",value:f,onChange:e=>G(e.currentTarget.value)})}),s.auth.user.role==="Admin"&&a.jsx(h.Col,{span:{base:6,sm:3},children:a.jsx(H,{disabled:!!s.lecturers.length,label:!s.lecturers.length&&"Harap isi data dosen dahulu!",children:a.jsx(b,{px:16,styles:{section:{marginRight:12}},radius:32,h:48,fullWidth:!0,disabled:!s.lecturers.length,leftSection:a.jsx(je,{}),onClick:()=>p.get(route("students.create")),children:"Tambah Mahasiswa"})})})]}),s.auth.user.role!=="Admin"&&a.jsx(d,{c:"blue",onClick:()=>X(u.map(e=>({NIM:e.user.id_number,"Nama Lengkap":e.user.full_name,"Tahun Angkatan":e.academic_year,DPA:e.supervisor.user.full_name,"Tipe Kepribadian":e!=null&&e.tests.length?e==null?void 0:e.tests[0].personality:"-","Saran Pekerjaan":e!=null&&e.tests.length?e==null?void 0:e.tests[0].work.name:"-"})),Q),children:"Cetak Laporan"}),s.auth.user.role!=="Admin"&&a.jsxs(h,{children:[o&&a.jsx(h.Col,{span:4,children:a.jsxs(j,{children:[a.jsx(d,{fw:600,children:"Nama Dosen PA :"}),a.jsx(d,{children:((D=s.lecturers.find(e=>e.user.id===o))==null?void 0:D.user.full_name)||"Nama tidak ditemukan"})]})}),a.jsx(h.Col,{span:o?4:6,children:a.jsx(Y,{children:a.jsxs(j,{children:[a.jsx(d,{fw:600,children:"Saran Pekerjaan :"}),a.jsx(T,{children:Object.entries(N).map(([e,r])=>a.jsxs(T.Item,{children:[e," : ",r," Mahasiswa"]},e))}),a.jsxs(d,{fw:600,children:["Total Mahasiswa: ",Object.values(N).reduce((e,r)=>e+r,0)]})]})})}),a.jsx(h.Col,{span:o?4:6,children:a.jsx(Y,{children:a.jsxs(j,{children:[a.jsx(d,{fw:600,children:"Tipe Kepribadian :"}),a.jsx(T,{children:Object.entries(L).map(([e,r])=>a.jsxs(T.Item,{children:[e," : ",r," Mahasiswa"]},e))}),a.jsxs(d,{fw:600,children:["Total Mahasiswa: ",Object.values(L).reduce((e,r)=>e+r,0)]})]})})})]}),a.jsx(le,{style:{borderRadius:32,border:"1px solid #E9ECEF"},children:a.jsx(n.ScrollContainer,{children:a.jsxs(n,{highlightOnHover:!0,withColumnBorders:!0,children:[a.jsx(n.Thead,{h:64,children:a.jsx(n.Tr,{children:q.map((e,r)=>a.jsx(n.Th,{px:16,py:0,style:{whiteSpace:"nowrap"},children:e},r))})}),a.jsx(n.Tbody,{children:u.map((e,r)=>{var i;return a.jsxs(n.Tr,{h:64,children:[a.jsx(n.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:r+1}),a.jsx(n.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:a.jsx(ce,{src:e.user.avatar,alt:e.user.full_name})}),a.jsx(n.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:e.user.id_number}),a.jsx(n.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:e.user.full_name}),a.jsx(n.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:e.user.id_number.substring(0,4)}),s.auth.user.role==="Admin"&&a.jsx(n.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:e.user.email}),s.auth.user.role==="Admin"?a.jsxs(a.Fragment,{children:[a.jsx(n.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:e.user.phone_number}),a.jsx(n.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:(i=e==null?void 0:e.supervisor)==null?void 0:i.user.full_name})]}):a.jsx(n.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:e!=null&&e.tests.length?e==null?void 0:e.tests[0].personality:"-"}),a.jsx(n.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:a.jsx(be,{checked:e.user.is_actived,onClick:()=>p.put(route("students.is_actived",e.user_id))})}),a.jsx(n.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:s.auth.user.role==="Admin"?a.jsxs(de,{gap:16,children:[a.jsx(b,{px:16,h:48,radius:32,styles:{section:{marginRight:16}},variant:"outline",color:"yellow",onClick:()=>p.get(route("students.edit",e.user_id)),children:"Ubah"}),a.jsx(b,{px:16,h:48,radius:32,styles:{section:{marginRight:16}},variant:"outline",color:"red",onClick:()=>p.delete(route("students.destroy",e.user_id)),children:"Hapus"})]}):a.jsx(H,{label:!(e!=null&&e.tests.length)&&"Mahasiswa belum melakukan tes kepribadian!",children:a.jsx(b,{disabled:!(e!=null&&e.tests.length),px:16,h:48,radius:32,styles:{section:{marginRight:16}},variant:"outline",color:"yellow",onClick:()=>p.get(route("students.tests.index",e.user_id)),children:"Detail"})})})]},r)})})]})})})]})})};export{Be as default};
