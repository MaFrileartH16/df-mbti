import{r as x,j as a,F as m,B as ne}from"./app-Cq8Aqup0.js";import{A as le,S as g,a as oe,T as H,B as u,f as d,i as he,F as ce}from"./AppLayout-CwXQp4_H.js";import{M as de,E as me,a as pe}from"./jspdf.plugin.autotable-B3dlSi6n.js";import{G as h}from"./Grid-BLd9FAEw.js";import{I as z}from"./use-dates-input-CpJwWc26.js";import{S as J}from"./Select-BK8-61w5.js";import{T as xe}from"./TextInput-Vkdi3ASe.js";import{I as ge}from"./IconSearch-C4hnKsdy.js";import{I as ue}from"./IconPlus-CxLU_Abg.js";import{C as Y}from"./Center-BqJQc4MY.js";import{L as j}from"./List-ChWRmKud.js";import{T as n}from"./Table-BYzJAVfk.js";import{C as je}from"./Checkbox-DUeoufAB.js";import"./get-base-value-Bl6g-Q_K.js";import"./InputBase-CEIJ_Rsw.js";import"./Input-BTJoUmQC.js";import"./clamp-DTmYCdls.js";import"./CheckIcon-DaSv3lMC.js";import"./ScrollArea-YXKuiWdK.js";import"./get-auto-contrast-value-Da6zqqWm.js";import"./InputsGroupFieldset-IE4ZGy-2.js";const Be=s=>{var L;console.log(s);const[b,G]=x.useState(""),[T,_]=x.useState(""),[M,U]=x.useState(""),[o,V]=x.useState(s.auth.user.role==="Dosen PA"?s.auth.user.id:""),p=s.students.filter(e=>(!b||e.user.full_name.toLowerCase().includes(b.toLowerCase()))&&(!M||e.academic_year===M)&&(!o||e.supervisor_id===o)&&(!T||T===""||e.tests.length&&new Date(e.tests[0].created_at).toLocaleDateString("id-ID").includes(T))),q=s.auth.user.role==="Admin"?["#","Foto","NIM","Nama Lengkap","Tahun Angkatan","Email","Nomor Telepon","DPA","Aktif","Opsi"]:["#","Foto","NIM","Nama Lengkap","Tahun Angkatan","Tipe Kepribadian","Aktif","Opsi"],Q=[{header:"NIM"},{header:"Nama Lengkap"},{header:"Tahun Angkatan"},{header:"Dosen PA"},{header:"Tipe Kepribadian"},{header:"Saran Pekerjaan"}],v=p.reduce((e,r)=>{const i=r!=null&&r.tests.length?r==null?void 0:r.tests[0].work.name:"-";return i!=="-"&&(e[i]=(e[i]||0)+1),e},{}),N=p.reduce((e,r)=>{const i=r!=null&&r.tests.length?r==null?void 0:r.tests[0].personality:"-";return i!=="-"&&(e[i]=(e[i]||0)+1),e},{}),X=(e,r)=>{var B,W;const i=new me;i.addImage("/unsada.png","PNG",10,10,30,30),i.setFontSize(12),i.text("UNIVERSITAS DARMA PERSADA",50,15),i.text("Jl. Taman Malaka Selatan, Pondok Kelapa, Jakarta Timur, Indonesia 13450",50,20),i.text("Telp. (021) 8649051, 8649053, 8649057 Fax. (021) 8649052",50,25),i.text("E-mail : humas@unsada.ac.id Home page : http//www.unsada.ac.id",50,30),i.setLineWidth(.5),i.line(10,40,200,40);const D=new Date,R=`Periode: ${["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"][D.getMonth()]} ${D.getFullYear()}`;i.setFontSize(18);const F="LAPORAN HASIL TES KEPRIBADIAN MAHASISWA",Z=i.getTextWidth(F);i.text(F,(i.internal.pageSize.width-Z)/2,50),i.setFontSize(12);const ee=i.getTextWidth(R);i.text(R,(i.internal.pageSize.width-ee)/2,60);const w=e.filter(t=>t["Tipe Kepribadian"]&&t["Saran Pekerjaan"]&&t["Tipe Kepribadian"]!=="-"&&t["Saran Pekerjaan"]!=="-"),f=w.reduce((t,l)=>(t[l["Saran Pekerjaan"]]=(t[l["Saran Pekerjaan"]]||0)+1,t),{}),S=w.reduce((t,l)=>(t[l["Tipe Kepribadian"]]=(t[l["Tipe Kepribadian"]]||0)+1,t),{});let c=70;o&&(i.text("Nama Dosen PA:",10,c),i.text(((B=s.lecturers.find(t=>t.user.id===o))==null?void 0:B.user.full_name)||"Nama tidak ditemukan",50,c)),i.text("Saran Pekerjaan:",10,c+10),Object.entries(f).forEach(([t,l],I)=>{i.text(`${t}: ${l} Mahasiswa`,10,c+15+I*5)});const ae=Object.values(f).reduce((t,l)=>t+l,0);i.text(`Total Mahasiswa: ${ae}`,10,c+15+Object.entries(f).length*5),i.text("Tipe Kepribadian:",110,c+10),Object.entries(S).forEach(([t,l],I)=>{i.text(`${t}: ${l} Mahasiswa`,110,c+15+I*5)});const ie=Object.values(S).reduce((t,l)=>t+l,0);i.text(`Total Mahasiswa: ${ie}`,110,c+15+Object.entries(S).length*5);const re=w.map(t=>Object.values(t)),te=r.map(t=>t.header);pe(i,{startY:c+50,head:[te],body:re});const k=o?(W=s.lecturers.find(t=>t.user.id===o))==null?void 0:W.user:s.auth.user,se=k.role,O=k.full_name,E=k.id_number,K=se==="Admin"?"Kepala Prodi":"Dosen Pembimbing Akademik";i.setFontSize(12);const y=i.internal.pageSize.width,A=i.internal.pageSize.height,C=10,P=20,$=5;i.text(K,y-C-i.getTextWidth(K),A-P),i.text(O,y-C-i.getTextWidth(O),A-P+$),i.text(`NIDN: ${E}`,y-C-i.getTextWidth(`NIDN: ${E}`),A-P+2*$),i.save("mrt-pdf-example.pdf")};return a.jsx(le,{title:"Mahasiswa",activeNav:"Mahasiswa",authed:s.auth.user,meta:s.meta,children:a.jsxs(g,{gap:32,children:[a.jsxs(h,{grow:!0,children:[a.jsx(h.Col,{span:{base:6,sm:3},children:a.jsx(de,{styles:{label:{marginBottom:8},input:{height:48,borderRadius:32,paddingLeft:50,paddingRight:16},section:{marginLeft:0,width:48,height:48},error:{marginTop:8}},leftSection:a.jsx(z,{}),clearable:!0,searchable:!0,placeholder:"Periode",checkIconPosition:"right",onChange:e=>{_(e?`${e.getMonth()+1}/${e.getFullYear()}`:"")}})}),a.jsx(h.Col,{span:{base:6,sm:3},children:a.jsx(J,{styles:{label:{marginBottom:8},input:{height:48,borderRadius:32,paddingLeft:50,paddingRight:16},section:{marginLeft:0,width:48,height:48},error:{marginTop:8}},leftSection:a.jsx(oe,{}),clearable:!0,searchable:!0,value:o,disabled:s.auth.user.role==="Dosen PA",nothingFoundMessage:"Tidak ada dosen pembimbing",checkIconPosition:"right",placeholder:"Dosen Pembimbing",data:s.lecturers.map(e=>({label:e.user.full_name,value:e.user.id})).sort((e,r)=>e.label.localeCompare(r.label)),onChange:e=>V(e)})}),a.jsx(h.Col,{span:{base:6,sm:3},children:a.jsx(J,{styles:{label:{marginBottom:8},input:{height:48,borderRadius:32,paddingLeft:50,paddingRight:16},section:{marginLeft:0,width:48,height:48},error:{marginTop:8}},leftSection:a.jsx(z,{}),clearable:!0,searchable:!0,placeholder:"Tahun Angkatan",checkIconPosition:"right",nothingFoundMessage:"Tidak ada tahun ajaran",data:s.auth.user.role==="Admin"?[...new Set(s.students.map(e=>e.academic_year))].sort((e,r)=>r-e):[...new Set(s.students.filter(e=>e.supervisor_id===s.auth.user.id).map(e=>e.academic_year))].sort((e,r)=>r-e),onChange:e=>U(e)})}),a.jsx(h.Col,{span:{base:6,sm:3},children:a.jsx(xe,{styles:{label:{marginBottom:8},input:{height:48,borderRadius:32,paddingLeft:50,paddingRight:16},section:{marginLeft:0,width:48,height:48},error:{marginTop:8}},leftSection:a.jsx(ge,{}),placeholder:"Cari mahasiswa...",value:b,onChange:e=>G(e.currentTarget.value)})}),s.auth.user.role==="Admin"&&a.jsx(h.Col,{span:{base:6,sm:3},children:a.jsx(H,{disabled:!!s.lecturers.length,label:!s.lecturers.length&&"Harap isi data dosen dahulu!",children:a.jsx(u,{px:16,styles:{section:{marginRight:12}},radius:32,h:48,fullWidth:!0,disabled:!s.lecturers.length,leftSection:a.jsx(ue,{}),onClick:()=>m.get(route("students.create")),children:"Tambah Mahasiswa"})})})]}),a.jsx(d,{c:"blue",onClick:()=>X(p.map(e=>({NIM:e.user.id_number,"Nama Lengkap":e.user.full_name,"Tahun Angkatan":e.academic_year,DPA:e.supervisor.user.full_name,"Tipe Kepribadian":e!=null&&e.tests.length?e==null?void 0:e.tests[0].personality:"-","Saran Pekerjaan":e!=null&&e.tests.length?e==null?void 0:e.tests[0].work.name:"-"})),Q),children:"Cetak Laporan"}),a.jsxs(h,{children:[o&&a.jsx(h.Col,{span:4,children:a.jsxs(g,{children:[a.jsx(d,{fw:600,children:"Nama Dosen PA :"}),a.jsx(d,{children:((L=s.lecturers.find(e=>e.user.id===o))==null?void 0:L.user.full_name)||"Nama tidak ditemukan"})]})}),a.jsx(h.Col,{span:o?4:6,children:a.jsx(Y,{children:a.jsxs(g,{children:[a.jsx(d,{fw:600,children:"Saran Pekerjaan :"}),a.jsx(j,{children:Object.entries(v).map(([e,r])=>a.jsxs(j.Item,{children:[e," : ",r," Mahasiswa"]},e))}),a.jsxs(d,{fw:600,children:["Total Mahasiswa: ",Object.values(v).reduce((e,r)=>e+r,0)]})]})})}),a.jsx(h.Col,{span:o?4:6,children:a.jsx(Y,{children:a.jsxs(g,{children:[a.jsx(d,{fw:600,children:"Tipe Kepribadian :"}),a.jsx(j,{children:Object.entries(N).map(([e,r])=>a.jsxs(j.Item,{children:[e," : ",r," Mahasiswa"]},e))}),a.jsxs(d,{fw:600,children:["Total Mahasiswa: ",Object.values(N).reduce((e,r)=>e+r,0)]})]})})})]}),a.jsx(ne,{style:{borderRadius:32,border:"1px solid #E9ECEF"},children:a.jsx(n.ScrollContainer,{children:a.jsxs(n,{highlightOnHover:!0,withColumnBorders:!0,children:[a.jsx(n.Thead,{h:64,children:a.jsx(n.Tr,{children:q.map((e,r)=>a.jsx(n.Th,{px:16,py:0,style:{whiteSpace:"nowrap"},children:e},r))})}),a.jsx(n.Tbody,{children:p.map((e,r)=>{var i;return a.jsxs(n.Tr,{h:64,children:[a.jsx(n.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:r+1}),a.jsx(n.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:a.jsx(he,{src:e.user.avatar,alt:e.user.full_name})}),a.jsx(n.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:e.user.id_number}),a.jsx(n.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:e.user.full_name}),a.jsx(n.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:e.user.id_number.substring(0,4)}),s.auth.user.role==="Admin"&&a.jsx(n.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:e.user.email}),s.auth.user.role==="Admin"?a.jsxs(a.Fragment,{children:[a.jsx(n.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:e.user.phone_number}),a.jsx(n.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:(i=e==null?void 0:e.supervisor)==null?void 0:i.user.full_name})]}):a.jsx(n.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:e!=null&&e.tests.length?e==null?void 0:e.tests[0].personality:"-"}),a.jsx(n.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:a.jsx(je,{checked:e.user.is_actived,onClick:()=>m.put(route("students.is_actived",e.user_id))})}),a.jsx(n.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:s.auth.user.role==="Admin"?a.jsxs(ce,{gap:16,children:[a.jsx(u,{px:16,h:48,radius:32,styles:{section:{marginRight:16}},variant:"outline",color:"yellow",onClick:()=>m.get(route("students.edit",e.user_id)),children:"Ubah"}),a.jsx(u,{px:16,h:48,radius:32,styles:{section:{marginRight:16}},variant:"outline",color:"red",onClick:()=>m.delete(route("students.destroy",e.user_id)),children:"Hapus"})]}):a.jsx(H,{label:!(e!=null&&e.tests.length)&&"Mahasiswa belum melakukan tes kepribadian!",children:a.jsx(u,{disabled:!(e!=null&&e.tests.length),px:16,h:48,radius:32,styles:{section:{marginRight:16}},variant:"outline",color:"yellow",onClick:()=>m.get(route("students.tests.index",e.user_id)),children:"Detail"})})})]},r)})})]})})})]})})};export{Be as default};
