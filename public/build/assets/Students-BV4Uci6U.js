import{r as m,j as a,B as ie,F as te}from"./app-Cq8Aqup0.js";import{A as se,S as x,a as ne,f as p,i as oe,B as le}from"./AppLayout-CwXQp4_H.js";import{M as he,E as ce,a as pe}from"./jspdf.plugin.autotable-B3dlSi6n.js";import{G as c}from"./Grid-BLd9FAEw.js";import{I as B}from"./use-dates-input-CpJwWc26.js";import{S as W}from"./Select-BK8-61w5.js";import{T as de}from"./TextInput-Vkdi3ASe.js";import{I as me}from"./IconSearch-C4hnKsdy.js";import{C as z}from"./Center-BqJQc4MY.js";import{L as g}from"./List-ChWRmKud.js";import{T as s}from"./Table-BYzJAVfk.js";import"./get-base-value-Bl6g-Q_K.js";import"./InputBase-CEIJ_Rsw.js";import"./Input-BTJoUmQC.js";import"./clamp-DTmYCdls.js";import"./CheckIcon-DaSv3lMC.js";import"./ScrollArea-YXKuiWdK.js";const ve=n=>{var L;const[j,H]=m.useState(""),[b,I]=m.useState(""),[C,J]=m.useState(""),[l,Y]=m.useState(n.auth.user.role==="Dosen PA"?n.auth.user.id:""),d=n.students.filter(e=>(!j||e.user.full_name.toLowerCase().includes(j.toLowerCase()))&&(!C||e.academic_year===C)&&(!l||e.supervisor_id===l)&&(!b||b===""||e.tests.length&&new Date(e.tests[0].created_at).toLocaleDateString("id-ID").includes(b))),M=d.reduce((e,i)=>{const r=i!=null&&i.tests.length?i==null?void 0:i.tests[0].work.name:"-";return r!=="-"&&(e[r]=(e[r]||0)+1),e},{}),D=d.reduce((e,i)=>{const r=i!=null&&i.tests.length?i==null?void 0:i.tests[0].personality:"-";return r!=="-"&&(e[r]=(e[r]||0)+1),e},{}),G=(e,i)=>{var K,$;const r=new ce;r.addImage("/unsada.png","PNG",10,10,30,30),r.setFontSize(12),r.text("UNIVERSITAS DARMA PERSADA",50,15),r.text("Jl. Taman Malaka Selatan, Pondok Kelapa, Jakarta Timur, Indonesia 13450",50,20),r.text("Telp. (021) 8649051, 8649053, 8649057 Fax. (021) 8649052",50,25),r.text("E-mail : humas@unsada.ac.id Home page : http//www.unsada.ac.id",50,30),r.setLineWidth(.5),r.line(10,40,200,40);const N=new Date,v=`Periode: ${["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"][N.getMonth()]} ${N.getFullYear()}`;r.setFontSize(18);const _="LAPORAN HASIL TES KEPRIBADIAN MAHASISWA",q=r.getTextWidth(_);r.text(_,(r.internal.pageSize.width-q)/2,50),r.setFontSize(12);const Q=r.getTextWidth(v);r.text(v,(r.internal.pageSize.width-Q)/2,60);const u=e.filter(t=>t["Tipe Kepribadian"]&&t["Saran Pekerjaan"]&&t["Tipe Kepribadian"]!=="-"&&t["Saran Pekerjaan"]!=="-"),S=u.reduce((t,o)=>(t[o["Saran Pekerjaan"]]=(t[o["Saran Pekerjaan"]]||0)+1,t),{}),T=u.reduce((t,o)=>(t[o["Tipe Kepribadian"]]=(t[o["Tipe Kepribadian"]]||0)+1,t),{});let h=70;l&&(r.text("Nama Dosen PA:",10,h),r.text(((K=n.lecturers.find(t=>t.user.id===l))==null?void 0:K.user.full_name)||"Nama tidak ditemukan",50,h)),r.text("Saran Pekerjaan:",10,h+10),Object.entries(S).forEach(([t,o],P)=>{r.text(`${t}: ${o} Mahasiswa`,10,h+15+P*5)});const X=Object.values(S).reduce((t,o)=>t+o,0);r.text(`Total Mahasiswa: ${X}`,10,h+15+Object.entries(S).length*5),r.text("Tipe Kepribadian:",110,h+10),Object.entries(T).forEach(([t,o],P)=>{r.text(`${t}: ${o} Mahasiswa`,110,h+15+P*5)});const Z=Object.values(T).reduce((t,o)=>t+o,0);r.text(`Total Mahasiswa: ${Z}`,110,h+15+Object.entries(T).length*5);const ee=u.map(t=>Object.values(t)),ae=i.map(t=>t.header);pe(r,{startY:h+50,head:[ae],body:ee});const w=l?($=n.lecturers.find(t=>t.user.id===l))==null?void 0:$.user:n.auth.user,re=w.role,R=w.full_name,O=w.id_number,E=re==="Admin"?"Kepala Prodi":"Dosen Pembimbing Akademik";r.setFontSize(12);const f=r.internal.pageSize.width,y=r.internal.pageSize.height,k=10,A=20,F=5;r.text(E,f-k-r.getTextWidth(E),y-A),r.text(R,f-k-r.getTextWidth(R),y-A+F),r.text(`NIDN: ${O}`,f-k-r.getTextWidth(`NIDN: ${O}`),y-A+2*F),r.save("mrt-pdf-example.pdf")},U=n.auth.user.role==="Admin"&&["#","Foto","NIM","Nama Lengkap","Tahun Angkatan","Dosen PA","Tipe Kepribadian","Saran Pekerjaan","Opsi"],V=[{header:"NIM"},{header:"Nama Lengkap"},{header:"Tahun Angkatan"},{header:"Dosen PA"},{header:"Tipe Kepribadian"},{header:"Saran Pekerjaan"}];return a.jsx(se,{title:"Mahasiswa",activeNav:"Mahasiswa",authed:n.auth.user,meta:n.meta,children:a.jsxs(x,{gap:32,children:[a.jsxs(c,{grow:!0,children:[a.jsx(c.Col,{span:{base:6,sm:3},children:a.jsx(he,{styles:{label:{marginBottom:8},input:{height:48,borderRadius:32,paddingLeft:50,paddingRight:16},section:{marginLeft:0,width:48,height:48},error:{marginTop:8}},leftSection:a.jsx(B,{}),clearable:!0,searchable:!0,placeholder:"Periode",checkIconPosition:"right",onChange:e=>{I(e?`${e.getMonth()+1}/${e.getFullYear()}`:"")}})}),a.jsx(c.Col,{span:{base:6,sm:3},children:a.jsx(W,{styles:{label:{marginBottom:8},input:{height:48,borderRadius:32,paddingLeft:50,paddingRight:16},section:{marginLeft:0,width:48,height:48},error:{marginTop:8}},leftSection:a.jsx(B,{}),clearable:!0,searchable:!0,placeholder:"Tahun Angkatan",checkIconPosition:"right",nothingFoundMessage:"Tidak ada tahun ajaran",data:[...new Set(n.students.map(e=>e.academic_year))].sort((e,i)=>i-e),onChange:e=>J(e)})}),a.jsx(c.Col,{span:{base:6,sm:3},children:a.jsx(W,{styles:{label:{marginBottom:8},input:{height:48,borderRadius:32,paddingLeft:50,paddingRight:16},section:{marginLeft:0,width:48,height:48},error:{marginTop:8}},leftSection:a.jsx(ne,{}),clearable:!0,searchable:!0,value:l,disabled:n.auth.user.role==="Dosen PA",nothingFoundMessage:"Tidak ada dosen pembimbing",checkIconPosition:"right",placeholder:"Dosen Pembimbing",data:n.lecturers.map(e=>({label:e.user.full_name,value:e.user.id})).sort((e,i)=>e.label.localeCompare(i.label)),onChange:e=>Y(e)})}),a.jsx(c.Col,{span:{base:6,sm:3},children:a.jsx(de,{styles:{label:{marginBottom:8},input:{height:48,borderRadius:32,paddingLeft:50,paddingRight:16},section:{marginLeft:0,width:48,height:48},error:{marginTop:8}},leftSection:a.jsx(me,{}),placeholder:"Cari mahasiswa...",value:j,onChange:e=>H(e.currentTarget.value)})})]}),a.jsx(p,{c:"blue",onClick:()=>G(d.map(e=>({NIM:e.user.id_number,"Nama Lengkap":e.user.full_name,"Tahun Angkatan":e.academic_year,DPA:e.supervisor.user.full_name,"Tipe Kepribadian":e!=null&&e.tests.length?e==null?void 0:e.tests[0].personality:"-","Saran Pekerjaan":e!=null&&e.tests.length?e==null?void 0:e.tests[0].work.name:"-"})),V),children:"Cetak Laporan"}),a.jsxs(c,{children:[l&&a.jsx(c.Col,{span:4,children:a.jsxs(x,{children:[a.jsx(p,{fw:600,children:"Nama Dosen PA :"}),a.jsx(p,{children:((L=n.lecturers.find(e=>e.user.id===l))==null?void 0:L.user.full_name)||"Nama tidak ditemukan"})]})}),a.jsx(c.Col,{span:l?4:6,children:a.jsx(z,{children:a.jsxs(x,{children:[a.jsx(p,{fw:600,children:"Saran Pekerjaan :"}),a.jsx(g,{children:Object.entries(M).map(([e,i])=>a.jsxs(g.Item,{children:[e," : ",i," Mahasiswa"]},e))}),a.jsxs(p,{fw:600,children:["Total Mahasiswa: ",Object.values(M).reduce((e,i)=>e+i,0)]})]})})}),a.jsx(c.Col,{span:l?4:6,children:a.jsx(z,{children:a.jsxs(x,{children:[a.jsx(p,{fw:600,children:"Tipe Kepribadian :"}),a.jsx(g,{children:Object.entries(D).map(([e,i])=>a.jsxs(g.Item,{children:[e," : ",i," Mahasiswa"]},e))}),a.jsxs(p,{fw:600,children:["Total Mahasiswa: ",Object.values(D).reduce((e,i)=>e+i,0)]})]})})})]}),a.jsx(ie,{style:{borderRadius:32,border:"1px solid #E9ECEF"},children:a.jsx(s.ScrollContainer,{children:a.jsxs(s,{highlightOnHover:!0,withColumnBorders:!0,children:[a.jsx(s.Thead,{h:64,children:a.jsx(s.Tr,{children:U.map((e,i)=>a.jsx(s.Th,{px:16,py:0,style:{whiteSpace:"nowrap"},children:e},i))})}),a.jsx(s.Tbody,{children:d.map((e,i)=>{var r;return a.jsxs(s.Tr,{h:64,children:[a.jsx(s.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:i+1}),a.jsx(s.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:a.jsx(oe,{src:e.user.avatar,alt:e.user.full_name})}),a.jsx(s.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:e.user.id_number}),a.jsx(s.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:e.user.full_name}),n.auth.user.role==="Admin"&&a.jsx(s.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:e.user.id_number.substring(0,4)}),a.jsx(s.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:(r=e==null?void 0:e.supervisor)==null?void 0:r.user.full_name}),a.jsx(s.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:e!=null&&e.tests.length?e==null?void 0:e.tests[0].personality:"-"}),a.jsx(s.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:e!=null&&e.tests.length?e==null?void 0:e.tests[0].work.name:"-"}),a.jsx(s.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:a.jsx(le,{disabled:!(e!=null&&e.tests.length),px:16,h:48,radius:32,styles:{section:{marginRight:16}},variant:"outline",color:"yellow",onClick:()=>te.get(route("students.tests.index",e.user_id)),children:"Detail"})})]},i)})})]})})})]})})};export{ve as default};
