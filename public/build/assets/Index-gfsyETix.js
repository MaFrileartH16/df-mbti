import{r as u,j as a,F as p,B as se}from"./app-ujya-KCz.js";import{A as ne,S as j,a as le,T as W,B as b,f as d,i as oe,F as he}from"./AppLayout-uetAMH0A.js";import{M as ce,E as de,a as me}from"./jspdf.plugin.autotable-DYWG1lk8.js";import{G as h}from"./Grid-Bur5Fcdp.js";import{I as H}from"./use-dates-input-Dgk_-w9H.js";import{S as z}from"./Select-Cxm2Nn1D.js";import{T as pe}from"./TextInput-RZZTAhZD.js";import{I as xe}from"./IconSearch-BPXhK1Gi.js";import{I as ge}from"./IconPlus-BIpI-MEw.js";import{C as J}from"./Center-AKgzOOpp.js";import{L as T}from"./List-9dn9vg5L.js";import{T as n}from"./Table-D29K3aYW.js";import{C as ue}from"./Checkbox-g4VCRP2-.js";import"./get-base-value-OFsWh4f6.js";import"./InputBase-o0xNPV29.js";import"./Input-D_xKmpb8.js";import"./clamp-DTmYCdls.js";import"./CheckIcon-DPnDoRdz.js";import"./ScrollArea-BByIigrI.js";import"./get-auto-contrast-value-Da6zqqWm.js";import"./InputsGroupFieldset-BLgUyJIH.js";const Ke=s=>{var L;console.log(s);const[m,M]=u.useState("");u.useState("");const[_,Y]=u.useState(""),[o,G]=u.useState(s.auth.user.role==="Dosen PA"?s.auth.user.id:""),x=s.students.filter(e=>(!search||e.user.full_name.toLowerCase().includes(search.toLowerCase()))&&(!_||e.academic_year===_)&&(!o||e.supervisor_id===o)&&(!m||m===""||e.tests.length&&new Date(e.tests[0].created_at).toLocaleDateString("id-ID").includes(m))),U=s.auth.user.role==="Admin"?["#","Foto","NIM","Nama Lengkap","Tahun Angkatan","Email","Nomor Telepon","DPA","Aktif","Opsi"]:["#","Foto","NIM","Nama Lengkap","Tahun Angkatan","Tipe Kepribadian","Aktif","Opsi"],V=[{header:"NIM"},{header:"Nama Lengkap"},{header:"Tahun Angkatan"},{header:"Dosen PA"},{header:"Tipe Kepribadian"},{header:"Saran Pekerjaan"}],v=x.reduce((e,r)=>{const i=r!=null&&r.tests.length?r==null?void 0:r.tests[0].work.name:"-";return i!=="-"&&(e[i]=(e[i]||0)+1),e},{}),N=x.reduce((e,r)=>{const i=r!=null&&r.tests.length?r==null?void 0:r.tests[0].personality:"-";return i!=="-"&&(e[i]=(e[i]||0)+1),e},{}),q=(e,r)=>{var $,B;const i=new de;i.addImage("/unsada.png","PNG",10,10,30,30),i.setFontSize(12),i.text("UNIVERSITAS DARMA PERSADA",50,15),i.text("Jl. Taman Malaka Selatan, Pondok Kelapa, Jakarta Timur, Indonesia 13450",50,20),i.text("Telp. (021) 8649051, 8649053, 8649057 Fax. (021) 8649052",50,25),i.text("E-mail : humas@unsada.ac.id Home page : http//www.unsada.ac.id",50,30),i.setLineWidth(.5),i.line(10,40,200,40);const g=new Date,Q=["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"];if(m){const[t,l]=m.split("/");g.setMonth(t-1),g.setFullYear(l)}const D=`Periode: ${Q[g.getMonth()]} ${g.getFullYear()}`;i.setFontSize(18);const R="LAPORAN HASIL TES KEPRIBADIAN MAHASISWA",X=i.getTextWidth(R);i.text(R,(i.internal.pageSize.width-X)/2,50),i.setFontSize(12);const Z=i.getTextWidth(D);i.text(D,(i.internal.pageSize.width-Z)/2,60);const f=e.filter(t=>t["Tipe Kepribadian"]&&t["Saran Pekerjaan"]&&t["Tipe Kepribadian"]!=="-"&&t["Saran Pekerjaan"]!=="-"),w=f.reduce((t,l)=>(t[l["Saran Pekerjaan"]]=(t[l["Saran Pekerjaan"]]||0)+1,t),{}),S=f.reduce((t,l)=>(t[l["Tipe Kepribadian"]]=(t[l["Tipe Kepribadian"]]||0)+1,t),{});let c=70;o&&(i.text("Nama Dosen PA:",10,c),i.text((($=s.lecturers.find(t=>t.user.id===o))==null?void 0:$.user.full_name)||"Nama tidak ditemukan",50,c)),i.text("Saran Pekerjaan:",10,c+10),Object.entries(w).forEach(([t,l],I)=>{i.text(`${t}: ${l} Mahasiswa`,10,c+15+I*5)});const ee=Object.values(w).reduce((t,l)=>t+l,0);i.text(`Total Mahasiswa: ${ee}`,10,c+15+Object.entries(w).length*5),i.text("Tipe Kepribadian:",110,c+10),Object.entries(S).forEach(([t,l],I)=>{i.text(`${t}: ${l} Mahasiswa`,110,c+15+I*5)});const ae=Object.values(S).reduce((t,l)=>t+l,0);i.text(`Total Mahasiswa: ${ae}`,110,c+15+Object.entries(S).length*5);const ie=f.map(t=>Object.values(t)),re=r.map(t=>t.header);me(i,{startY:c+50,head:[re],body:ie});const y=o?(B=s.lecturers.find(t=>t.user.id===o))==null?void 0:B.user:s.auth.user,te=y.role,F=y.full_name,O=y.id_number,E=te==="Admin"?"Kepala Prodi":"Dosen Pembimbing Akademik";i.setFontSize(12);const k=i.internal.pageSize.width,A=i.internal.pageSize.height,C=10,P=20,K=5;i.text(E,k-C-i.getTextWidth(E),A-P),i.text(F,k-C-i.getTextWidth(F),A-P+K),i.text(`NIDN: ${O}`,k-C-i.getTextWidth(`NIDN: ${O}`),A-P+2*K),i.save("mrt-pdf-example.pdf")};return a.jsx(ne,{title:"Mahasiswa",activeNav:"Mahasiswa",authed:s.auth.user,meta:s.meta,children:a.jsxs(j,{gap:32,children:[a.jsxs(h,{grow:!0,children:[a.jsx(h.Col,{span:{base:6,sm:3},children:a.jsx(ce,{styles:{label:{marginBottom:8},input:{height:48,borderRadius:32,paddingLeft:50,paddingRight:16},section:{marginLeft:0,width:48,height:48},error:{marginTop:8}},leftSection:a.jsx(H,{}),clearable:!0,searchable:!0,placeholder:"Periode",checkIconPosition:"right",onChange:e=>{M(e?`${e.getMonth()+1}/${e.getFullYear()}`:"")}})}),a.jsx(h.Col,{span:{base:6,sm:3},children:a.jsx(z,{styles:{label:{marginBottom:8},input:{height:48,borderRadius:32,paddingLeft:50,paddingRight:16},section:{marginLeft:0,width:48,height:48},error:{marginTop:8}},leftSection:a.jsx(le,{}),clearable:!0,searchable:!0,value:o,disabled:s.auth.user.role==="Dosen PA",nothingFoundMessage:"Tidak ada dosen pembimbing",checkIconPosition:"right",placeholder:"Dosen Pembimbing",data:s.lecturers.map(e=>({label:e.user.full_name,value:e.user.id})).sort((e,r)=>e.label.localeCompare(r.label)),onChange:e=>G(e)})}),a.jsx(h.Col,{span:{base:6,sm:3},children:a.jsx(z,{styles:{label:{marginBottom:8},input:{height:48,borderRadius:32,paddingLeft:50,paddingRight:16},section:{marginLeft:0,width:48,height:48},error:{marginTop:8}},leftSection:a.jsx(H,{}),clearable:!0,searchable:!0,placeholder:"Tahun Angkatan",checkIconPosition:"right",nothingFoundMessage:"Tidak ada tahun ajaran",data:s.auth.user.role==="Admin"?[...new Set(s.students.map(e=>e.academic_year))].sort((e,r)=>r-e):[...new Set(s.students.filter(e=>e.supervisor_id===s.auth.user.id).map(e=>e.academic_year))].sort((e,r)=>r-e),onChange:e=>Y(e)})}),a.jsx(h.Col,{span:{base:6,sm:3},children:a.jsx(pe,{styles:{label:{marginBottom:8},input:{height:48,borderRadius:32,paddingLeft:50,paddingRight:16},section:{marginLeft:0,width:48,height:48},error:{marginTop:8}},leftSection:a.jsx(xe,{}),placeholder:"Cari mahasiswa...",value:search,onChange:e=>setSearch(e.currentTarget.value)})}),s.auth.user.role==="Admin"&&a.jsx(h.Col,{span:{base:6,sm:3},children:a.jsx(W,{disabled:!!s.lecturers.length,label:!s.lecturers.length&&"Harap isi data dosen dahulu!",children:a.jsx(b,{px:16,styles:{section:{marginRight:12}},radius:32,h:48,fullWidth:!0,disabled:!s.lecturers.length,leftSection:a.jsx(ge,{}),onClick:()=>p.get(route("students.create")),children:"Tambah Mahasiswa"})})})]}),a.jsx(d,{c:"blue",onClick:()=>q(x.map(e=>({NIM:e.user.id_number,"Nama Lengkap":e.user.full_name,"Tahun Angkatan":e.academic_year,DPA:e.supervisor.user.full_name,"Tipe Kepribadian":e!=null&&e.tests.length?e==null?void 0:e.tests[0].personality:"-","Saran Pekerjaan":e!=null&&e.tests.length?e==null?void 0:e.tests[0].work.name:"-"})),V),children:"Cetak Laporan"}),a.jsxs(h,{children:[o&&a.jsx(h.Col,{span:4,children:a.jsxs(j,{children:[a.jsx(d,{fw:600,children:"Nama Dosen PA :"}),a.jsx(d,{children:((L=s.lecturers.find(e=>e.user.id===o))==null?void 0:L.user.full_name)||"Nama tidak ditemukan"})]})}),a.jsx(h.Col,{span:o?4:6,children:a.jsx(J,{children:a.jsxs(j,{children:[a.jsx(d,{fw:600,children:"Saran Pekerjaan :"}),a.jsx(T,{children:Object.entries(v).map(([e,r])=>a.jsxs(T.Item,{children:[e," : ",r," Mahasiswa"]},e))}),a.jsxs(d,{fw:600,children:["Total Mahasiswa: ",Object.values(v).reduce((e,r)=>e+r,0)]})]})})}),a.jsx(h.Col,{span:o?4:6,children:a.jsx(J,{children:a.jsxs(j,{children:[a.jsx(d,{fw:600,children:"Tipe Kepribadian :"}),a.jsx(T,{children:Object.entries(N).map(([e,r])=>a.jsxs(T.Item,{children:[e," : ",r," Mahasiswa"]},e))}),a.jsxs(d,{fw:600,children:["Total Mahasiswa: ",Object.values(N).reduce((e,r)=>e+r,0)]})]})})})]}),a.jsx(se,{style:{borderRadius:32,border:"1px solid #E9ECEF"},children:a.jsx(n.ScrollContainer,{children:a.jsxs(n,{highlightOnHover:!0,withColumnBorders:!0,children:[a.jsx(n.Thead,{h:64,children:a.jsx(n.Tr,{children:U.map((e,r)=>a.jsx(n.Th,{px:16,py:0,style:{whiteSpace:"nowrap"},children:e},r))})}),a.jsx(n.Tbody,{children:x.map((e,r)=>{var i;return a.jsxs(n.Tr,{h:64,children:[a.jsx(n.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:r+1}),a.jsx(n.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:a.jsx(oe,{src:e.user.avatar,alt:e.user.full_name})}),a.jsx(n.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:e.user.id_number}),a.jsx(n.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:e.user.full_name}),a.jsx(n.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:e.user.id_number.substring(0,4)}),s.auth.user.role==="Admin"&&a.jsx(n.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:e.user.email}),s.auth.user.role==="Admin"?a.jsxs(a.Fragment,{children:[a.jsx(n.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:e.user.phone_number}),a.jsx(n.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:(i=e==null?void 0:e.supervisor)==null?void 0:i.user.full_name})]}):a.jsx(n.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:e!=null&&e.tests.length?e==null?void 0:e.tests[0].personality:"-"}),a.jsx(n.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:a.jsx(ue,{checked:e.user.is_actived,onClick:()=>p.put(route("students.is_actived",e.user_id))})}),a.jsx(n.Td,{px:16,py:0,style:{whiteSpace:"nowrap"},children:s.auth.user.role==="Admin"?a.jsxs(he,{gap:16,children:[a.jsx(b,{px:16,h:48,radius:32,styles:{section:{marginRight:16}},variant:"outline",color:"yellow",onClick:()=>p.get(route("students.edit",e.user_id)),children:"Ubah"}),a.jsx(b,{px:16,h:48,radius:32,styles:{section:{marginRight:16}},variant:"outline",color:"red",onClick:()=>p.delete(route("students.destroy",e.user_id)),children:"Hapus"})]}):a.jsx(W,{label:!(e!=null&&e.tests.length)&&"Mahasiswa belum melakukan tes kepribadian!",children:a.jsx(b,{disabled:!(e!=null&&e.tests.length),px:16,h:48,radius:32,styles:{section:{marginRight:16}},variant:"outline",color:"yellow",onClick:()=>p.get(route("students.tests.index",e.user_id)),children:"Detail"})})})]},r)})})]})})})]})})};export{Ke as default};
